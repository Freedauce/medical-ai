# System Diagrams

## AI Medical Voice Agent - Architecture & Flow Diagrams

---

## 1. Activity Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    USER CONSULTATION FLOW                        │
└─────────────────────────────────────────────────────────────────┘

                          ┌─────────┐
                          │  START  │
                          └────┬────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │   User Opens App     │
                    └──────────┬───────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │  Is User Logged In?  │◄────────────────┐
                    └──────────┬───────────┘                 │
                               │                             │
              ┌────────────────┴────────────────┐            │
              │ NO                              │ YES        │
              ▼                                 ▼            │
    ┌──────────────────┐               ┌──────────────────┐  │
    │  Show Login Page │               │  Show Dashboard  │  │
    └────────┬─────────┘               └────────┬─────────┘  │
             │                                  │            │
             ▼                                  ▼            │
    ┌──────────────────┐               ┌──────────────────┐  │
    │  Login/Register  │               │ Select Specialty │  │
    └────────┬─────────┘               └────────┬─────────┘  │
             │                                  │            │
             │ Success                          ▼            │
             └────────────────────────►┌──────────────────┐  │
                                       │Start Consultation│  │
                                       └────────┬─────────┘  │
                                                │            │
                                                ▼            │
                                       ┌──────────────────┐  │
                                       │ AI Doctor Greets │  │
                                       └────────┬─────────┘  │
                                                │            │
                                                ▼            │
                              ┌─────────────────────────────────┐
                              │    CONSULTATION LOOP            │
                              │  ┌───────────────────────────┐  │
                              │  │ User Speaks Symptoms      │  │
                              │  └─────────────┬─────────────┘  │
                              │                │                │
                              │                ▼                │
                              │  ┌───────────────────────────┐  │
                              │  │ AI Processes & Responds   │  │
                              │  └─────────────┬─────────────┘  │
                              │                │                │
                              │                ▼                │
                              │  ┌───────────────────────────┐  │
                              │  │ More Questions Needed?    │  │
                              │  └─────────────┬─────────────┘  │
                              │       YES │         │ NO        │
                              │           └────┐    │           │
                              │                │    │           │
                              └────────────────┼────┼───────────┘
                                               │    │
                                               │    ▼
                                               │  ┌──────────────────┐
                                               │  │ Get Prescription │
                                               │  └────────┬─────────┘
                                               │           │
                                               │           ▼
                                               │  ┌──────────────────┐
                                               │  │ Download Report  │
                                               │  └────────┬─────────┘
                                               │           │
                                               │           ▼
                                               │       ┌─────────┐
                                               └──────►│   END   │
                                                       └─────────┘
```

---

## 2. Data Flow Diagram (DFD)

### Level 0 - Context Diagram

```
                    ┌─────────────────────────────┐
                    │                             │
    ┌───────┐       │    AI Medical Voice Agent   │       ┌─────────────┐
    │ User  │◄─────►│                             │◄─────►│  Gemini AI  │
    └───────┘       │                             │       └─────────────┘
        │           │                             │
        │           └─────────────────────────────┘
        │                        │
        │                        ▼
        │           ┌─────────────────────────────┐
        └──────────►│      PostgreSQL Database    │
                    └─────────────────────────────┘
```

### Level 1 - Detailed DFD

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              SYSTEM BOUNDARY                                 │
│                                                                             │
│  ┌─────────┐    Voice Input    ┌────────────────┐                          │
│  │         │──────────────────►│ 1.0            │                          │
│  │         │                   │ Speech         │    Transcript            │
│  │         │◄──────────────────│ Recognition    │───────────────┐          │
│  │         │    Transcript     └────────────────┘               │          │
│  │         │                                                    ▼          │
│  │  USER   │                                         ┌────────────────┐    │
│  │         │                   ┌─────────────────────│ 2.0            │    │
│  │         │    Response       │                     │ Chat API       │    │
│  │         │◄──────────────────┤                     │ Handler        │    │
│  │         │                   │                     └───────┬────────┘    │
│  │         │                   │                             │             │
│  └─────────┘                   │        Prompt               ▼             │
│       │                        │     ┌────────────────────────────────┐    │
│       │                        │     │ 3.0                            │    │
│       │    Login/Register      │     │ Gemini AI                      │    │
│       │                        │     │ Integration                    │    │
│       ▼                        │     └────────────────────────────────┘    │
│  ┌────────────────┐           │                    │                       │
│  │ 4.0            │           │                    │ AI Response           │
│  │ Authentication │           │                    │                       │
│  │ System         │           │◄───────────────────┘                       │
│  └───────┬────────┘           │                                            │
│          │                    ▼                                            │
│          │         ┌────────────────┐      ┌──────────────────────┐       │
│          │         │ 5.0            │      │                      │       │
│          └────────►│ Consultation   │─────►│  D1: PostgreSQL DB   │       │
│                    │ History        │      │  - Users             │       │
│                    └────────────────┘      │  - Consultations     │       │
│                                            └──────────────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Sequence Diagram

### Voice Consultation Sequence

```
┌──────┐          ┌─────────────┐          ┌─────────┐          ┌──────────┐          ┌────────┐
│ User │          │ Consultation│          │ Chat    │          │ Gemini   │          │Database│
│      │          │ Page        │          │ API     │          │ AI       │          │        │
└──┬───┘          └──────┬──────┘          └────┬────┘          └────┬─────┘          └───┬────┘
   │                     │                      │                    │                    │
   │  Select Specialty   │                      │                    │                    │
   │────────────────────►│                      │                    │                    │
   │                     │                      │                    │                    │
   │                     │ Initialize Speech    │                    │                    │
   │                     │ Recognition          │                    │                    │
   │                     │◄────────────────────►│                    │                    │
   │                     │                      │                    │                    │
   │                     │ Greeting Message     │                    │                    │
   │◄────────────────────│                      │                    │                    │
   │                     │                      │                    │                    │
   │  Speaks Symptoms    │                      │                    │                    │
   │────────────────────►│                      │                    │                    │
   │                     │                      │                    │                    │
   │                     │  POST /api/chat      │                    │                    │
   │                     │─────────────────────►│                    │                    │
   │                     │                      │                    │                    │
   │                     │                      │  Verify Session    │                    │
   │                     │                      │───────────────────►│                    │
   │                     │                      │◄───────────────────│                    │
   │                     │                      │                    │                    │
   │                     │                      │ generateContent()  │                    │
   │                     │                      │───────────────────►│                    │
   │                     │                      │                    │                    │
   │                     │                      │  AI Response       │                    │
   │                     │                      │◄───────────────────│                    │
   │                     │                      │                    │                    │
   │                     │  Response JSON       │                    │                    │
   │                     │◄─────────────────────│                    │                    │
   │                     │                      │                    │                    │
   │  Voice Response     │                      │                    │                    │
   │◄────────────────────│                      │                    │                    │
   │                     │                      │                    │                    │
   │  "That's all"       │                      │                    │                    │
   │────────────────────►│                      │                    │                    │
   │                     │                      │                    │                    │
   │                     │ POST /api/chat       │                    │                    │
   │                     │─────────────────────►│                    │                    │
   │                     │                      │                    │                    │
   │                     │  "Click Prescription"│                    │                    │
   │                     │◄─────────────────────│                    │                    │
   │                     │                      │                    │                    │
   │  Click Prescription │                      │                    │                    │
   │────────────────────►│                      │                    │                    │
   │                     │                      │                    │                    │
   │                     │                      │  Save Consultation │                    │
   │                     │                      │───────────────────────────────────────►│
   │                     │                      │                    │                    │
   │  Download Report    │                      │                    │                    │
   │◄────────────────────│                      │                    │                    │
   │                     │                      │                    │                    │
└──┴───┘          └──────┴──────┘          └────┴────┘          └────┴─────┘          └───┴────┘
```

---

## 4. Component Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              AI MEDICAL VOICE AGENT                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────┐    ┌─────────────────────────────────┐   │
│  │         FRONTEND                │    │           BACKEND               │   │
│  │  ┌───────────────────────────┐  │    │  ┌───────────────────────────┐  │   │
│  │  │       Next.js App         │  │    │  │       API Routes          │  │   │
│  │  │  ┌─────────────────────┐  │  │    │  │  ┌─────────────────────┐  │  │   │
│  │  │  │  Landing Page       │  │  │    │  │  │  /api/chat          │  │  │   │
│  │  │  └─────────────────────┘  │  │    │  │  └─────────────────────┘  │  │   │
│  │  │  ┌─────────────────────┐  │  │    │  │  ┌─────────────────────┐  │  │   │
│  │  │  │  Dashboard          │  │  │    │  │  │  /api/auth          │  │  │   │
│  │  │  └─────────────────────┘  │  │    │  │  └─────────────────────┘  │  │   │
│  │  │  ┌─────────────────────┐  │  │    │  │  ┌─────────────────────┐  │  │   │
│  │  │  │  Consultation       │◄─┼──┼────┼──┼─►│  /api/consultations │  │  │   │
│  │  │  └─────────────────────┘  │  │    │  │  └─────────────────────┘  │  │   │
│  │  │  ┌─────────────────────┐  │  │    │  └───────────────────────────┘  │   │
│  │  │  │  History            │  │  │    │                                  │   │
│  │  │  └─────────────────────┘  │  │    │  ┌───────────────────────────┐  │   │
│  │  └───────────────────────────┘  │    │  │     External Services     │  │   │
│  │                                  │    │  │  ┌─────────────────────┐  │  │   │
│  │  ┌───────────────────────────┐  │    │  │  │  Gemini AI API      │  │  │   │
│  │  │       Components         │  │    │  │  └─────────────────────┘  │  │   │
│  │  │  ┌─────────────────────┐  │  │    │  │  ┌─────────────────────┐  │  │   │
│  │  │  │  Sidebar            │  │  │    │  │  │  Google OAuth       │  │  │   │
│  │  │  └─────────────────────┘  │  │    │  │  └─────────────────────┘  │  │   │
│  │  │  ┌─────────────────────┐  │  │    │  │  ┌─────────────────────┐  │  │   │
│  │  │  │  VoiceRecorder      │  │  │    │  │  │  Neon PostgreSQL    │  │  │   │
│  │  │  └─────────────────────┘  │  │    │  │  └─────────────────────┘  │  │   │
│  │  └───────────────────────────┘  │    │  └───────────────────────────┘  │   │
│  └─────────────────────────────────┘    └─────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. ERD (Entity Relationship Diagram)

```
┌─────────────────────────┐          ┌─────────────────────────┐
│         USERS           │          │     CONSULTATIONS       │
├─────────────────────────┤          ├─────────────────────────┤
│ id (PK)                 │          │ id (PK)                 │
│ name                    │          │ clerkId (FK)            │
│ email (UNIQUE)          │◄────────►│ transcript              │
│ password                │          │ aiResponse              │
│ createdAt               │          │ createdAt               │
└─────────────────────────┘          └─────────────────────────┘
        │ 1                                       │ *
        │                                         │
        └────────────────has many────────────────►│
```

---

## Technology Stack

| Layer | Technology |
|-------|------------|
| Frontend | Next.js 16, React 19, TypeScript |
| Styling | Tailwind CSS |
| Animation | Motion (Framer Motion) |
| Authentication | NextAuth.js |
| Database | Neon PostgreSQL + Drizzle ORM |
| AI | Google Gemini 2.5 Flash |
| Voice | Web Speech API |
| Deployment | Vercel, Docker |
| Version Control | Git, GitHub |
